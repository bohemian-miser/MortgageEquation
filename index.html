<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Equation</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons (equivalent to DollarSign and Percent from Lucide React) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for the range input for better visual feedback */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 0 3px white, 0 0 0 4px;
        }
        input[type=range].accent-orange-500::-webkit-slider-thumb { box-shadow: 0 0 0 3px white, 0 0 0 4px #f97316; }
        input[type=range].accent-emerald-500::-webkit-slider-thumb { box-shadow: 0 0 0 3px white, 0 0 0 4px #10b981; }
        input[type=range].accent-red-500::-webkit-slider-thumb { box-shadow: 0 0 0 3px white, 0 0 0 4px #ef4444; }
        input[type=range].accent-yellow-500::-webkit-slider-thumb { box-shadow: 0 0 0 3px white, 0 0 0 4px #eab308; }
        input[type=range].accent-blue-600::-webkit-slider-thumb { box-shadow: 0 0 0 3px white, 0 0 0 4px #2563eb; }

        /* Ensure smooth SVG transitions */
        .transition-transform {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 700ms;
        }
    </style>
</head>
<body class="bg-slate-50">

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

// Utility component to render a slider with markers
const SliderWithMarkers = ({ label, subLabel, name, value, min, max, step, onChange, markers, accentColor, labelColor }) => {
    return (
        <div>
            <div className="flex justify-between items-baseline mb-1">
                <label className={`text-[10px] font-bold uppercase tracking-wide ${labelColor}`}>
                    {label} {subLabel && <span className="text-slate-400 font-normal normal-case ml-1">{subLabel}</span>}
                </label>
                <span className="font-mono text-xs font-bold text-slate-700">{value}%</span>
            </div>
            
            <input 
                type="range" 
                min={min} max={max} step={step} 
                name={name} 
                value={value} 
                onChange={onChange} 
                className={`w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer ${accentColor} mb-1`}
            />

            <div className="relative h-3 w-full text-[9px] text-slate-400 font-medium">
                {markers.map((m, i) => {
                    const pos = ((m.val - min) / (max - min)) * 100;
                    if (pos < 0 || pos > 100) return null;
                    return (
                        <div 
                            key={i} 
                            className="absolute flex flex-col items-center transform -translate-x-1/2"
                            style={{ left: `${pos}%` }}
                        >
                            <div className="w-px h-1 bg-slate-300 mb-0.5"></div>
                            <span>{m.val}</span>
                        </div>
                    )
                })}
            </div>
        </div>
    );
};

// Main Application Component
const RentVsBuySeesaw = () => {
  // --- State ---
  const [inputs, setInputs] = useState({
    homeValue: 500000,
    downPaymentPercent: 20,
    mortgageRate: 6.5,
    stockReturn: 8.5, // Net after tax
    appreciation: 4.0,
    feesRate: 2.5, // Maintenance + Tax + Insurance
    monthlyRent: 2500,
  });

  const [homeValueDisplay, setHomeValueDisplay] = useState("500,000");
  const [breakdown, setBreakdown] = useState({ buyCosts: [], rentCosts: [] });
  const [totals, setTotals] = useState({ 
    netBuyCost: 0, 
    grossBuyCost: 0, 
    netRentCost: 0,
    annualRent: 0, 
    totalAppreciation: 0,
    investmentReturn: 0 
  });

  // --- Calculations ---
  useEffect(() => {
    const H = inputs.homeValue;
    const D = H * (inputs.downPaymentPercent / 100);
    const Loan = H - D;
    
    // Costs (Annualized)
    const feesCost = H * (inputs.feesRate / 100);
    const interestCost = Loan * (inputs.mortgageRate / 100);
    
    // Gains (Annualized - Buy Side)
    const loanAppreciation = Loan * (inputs.appreciation / 100);
    const equityAppreciation = D * (inputs.appreciation / 100);
    const totalAppreciation = loanAppreciation + equityAppreciation;

    // Gains (Annualized - Rent Side - Investment Return on Down Payment)
    const investmentReturn = D * (inputs.stockReturn / 100);

    // Aggregates (Annualized Net Costs)
    const grossBuyCost = feesCost + interestCost;
    const netBuyCost = grossBuyCost - totalAppreciation;
    
    const annualRent = inputs.monthlyRent * 12;
    const netRentCost = annualRent - investmentReturn;

    setTotals({ 
      netBuyCost, 
      grossBuyCost, 
      netRentCost,
      annualRent, 
      totalAppreciation,
      investmentReturn
    });

    setBreakdown({
      buyCosts: [
        { 
            id: 'fees', 
            label: 'Fees & Maint', 
            value: feesCost, 
            color: '#ef4444' // red-500
        },
        { 
            id: 'interest', 
            label: 'Interest', 
            value: interestCost, 
            color: '#f97316' // orange-500
        },
      ]
    });

  }, [inputs]);

  // --- Handlers ---
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setInputs(prev => ({
      ...prev,
      [name]: parseFloat(value) || 0
    }));
  };

  const handleHomeValueChange = (e) => {
    const rawValue = e.target.value;
    setHomeValueDisplay(rawValue);
    const numericValue = parseFloat(rawValue.replace(/,/g, ''));
    if (!isNaN(numericValue)) {
       setInputs(prev => ({ ...prev, homeValue: numericValue }));
    }
  };

  const handleHomeValueFocus = () => {
    setHomeValueDisplay(inputs.homeValue.toString());
  };

  const handleHomeValueBlur = () => {
    setHomeValueDisplay(formatNumberWithCommas(inputs.homeValue));
  };

  // --- Visualization Logic ---
  
  // Dynamic Scaling for Stacks
  const maxStackValue = Math.max(totals.grossBuyCost, totals.annualRent, 1);
  const dynamicScale = 180 / (maxStackValue * 1.1); 

  // Dynamic Sizing for Balloons
  // Calculate radius based on value. Min radius: 35px, Max radius: 80px
  const calculateBalloonRadius = (val) => {
      if (val <= 0) return 35; 
      // Scale: 25 + sqrt(val) * factor (0.25 chosen empirically for good range)
      return Math.min(80, Math.max(35, 25 + Math.sqrt(val) * 0.25));
  };

  const greenRadius = calculateBalloonRadius(totals.totalAppreciation);
  const yellowRadius = calculateBalloonRadius(totals.investmentReturn);


  // Seesaw Physics
  // diff > 0 means Rent Cost > Buy Cost (Rent is "heavier", tips right)
  const diff = totals.netRentCost - totals.netBuyCost; 
  const maxTilt = 12; 
  const sensitivity = 15000; 
  let tiltAngle = (diff / sensitivity) * maxTilt;
  if (tiltAngle > maxTilt) tiltAngle = maxTilt;
  if (tiltAngle < -maxTilt) tiltAngle = -maxTilt;

  const beamLength = 500;
  const pivotX = 400;
  const pivotY = 420;

  // Formatters
  const formatMoney = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(val);
  const formatNumberWithCommas = (val) => new Intl.NumberFormat('en-US').format(val);

  return (
    <div className="flex flex-col items-center w-full min-h-screen bg-slate-50 text-slate-800 font-sans p-2 md:p-4 overflow-hidden">
      
      {/* HEADER */}
      <header className="w-full max-w-5xl mb-4 text-center shrink-0">
        <h1 className="text-2xl md:text-3xl font-bold text-slate-900 mb-2">The Mortgage Equation</h1>
        
        {/* EQUATION */}
        <div className="inline-flex flex-wrap items-center justify-center gap-x-1.5 gap-y-1 px-3 py-1.5 bg-white rounded-lg shadow-sm border border-slate-200 font-mono text-xs md:text-sm">
          <span className="font-bold text-slate-700">Rent</span>
          <span className="text-slate-400">-</span>
          <span className="text-yellow-600 font-bold">Investments</span>
          <span className="text-slate-400">&gt;</span>
          <span className="text-red-500 font-bold">Fees</span>
          <span className="text-slate-400">+</span>
          <span className="text-orange-500 font-bold">Interest</span>
          <span className="text-slate-400">-</span>
          <span className="text-emerald-500 font-bold">Appreciation</span>
        </div>
      </header>

      {/* MAIN CONTENT GRID */}
      <div className="flex flex-col lg:flex-row gap-4 w-full max-w-6xl flex-grow">
        
        {/* LEFT PANEL: INPUTS */}
        <div className="w-full lg:w-[350px] xl:w-[400px] shrink-0 bg-white p-4 rounded-xl shadow-sm border border-slate-200 order-2 lg:order-1 h-fit">
          <h2 className="text-sm font-bold text-slate-800 uppercase tracking-wider mb-4 border-b border-slate-100 pb-2">
            Variables
          </h2>

          <div className="space-y-4">
            {/* Home Value */}
            <div>
              <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-wide mb-1">Home Value</label>
              <div className="relative">
                <span className="absolute left-3 top-2 text-slate-500 font-mono text-sm">$</span>
                <input 
                  type="text" 
                  value={homeValueDisplay} 
                  onChange={handleHomeValueChange}
                  onFocus={handleHomeValueFocus}
                  onBlur={handleHomeValueBlur}
                  className="w-full pl-6 p-1.5 bg-slate-50 border border-slate-300 rounded focus:ring-1 focus:ring-blue-500 outline-none font-mono text-sm text-slate-700"
                />
              </div>
            </div>
            
            {/* Rent */}
            <div>
              <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-wide mb-1">Monthly Rent</label>
              <div className="flex items-start gap-3 bg-slate-50 p-2 rounded border border-slate-100">
                <div className="flex-grow pt-1">
                   <input 
                    type="range" min="500" max="15000" step="50" 
                    name="monthlyRent" value={inputs.monthlyRent} onChange={handleInputChange} 
                    className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-600"
                  />
                </div>
                <div className="flex flex-col items-end text-right min-w-[80px]">
                    <span className="font-mono text-lg font-bold text-slate-900 leading-none">
                        ${formatNumberWithCommas(inputs.monthlyRent)}
                    </span>
                    <span className="text-[10px] text-slate-500 font-mono mt-1">
                        ${formatNumberWithCommas(Math.round(inputs.monthlyRent * 12 / 52))}/wk
                    </span>
                    <span className="text-[10px] text-slate-500 font-mono">
                        ${formatNumberWithCommas(inputs.monthlyRent * 12)}/yr
                    </span>
                </div>
              </div>
            </div>

            <div className="w-full h-px bg-slate-100 my-2"></div>

            {/* Compact Sliders */}
            <div className="space-y-4">
                <SliderWithMarkers 
                    label="Mortgage Rate" 
                    name="mortgageRate" 
                    value={inputs.mortgageRate} 
                    min={0} max={15} step={0.1} 
                    onChange={handleInputChange}
                    markers={[ { val: 3, label: 'Low' }, { val: 6.5, label: 'Avg' }, { val: 14, label: 'High' } ]}
                    accentColor="accent-orange-500"
                    labelColor="text-orange-600"
                />

                <SliderWithMarkers 
                    label="Appreciation" 
                    name="appreciation" 
                    value={inputs.appreciation} 
                    min={-2} max={12} step={0.1} 
                    onChange={handleInputChange}
                    markers={[ { val: 2, label: 'Slow' }, { val: 4, label: 'Avg' }, { val: 8, label: 'Hot' } ]}
                    accentColor="accent-emerald-500"
                    labelColor="text-emerald-600"
                />

                <SliderWithMarkers 
                    label="Fees & Maintenance" 
                    name="feesRate" 
                    value={inputs.feesRate} 
                    min={0} max={5} step={0.1} 
                    onChange={handleInputChange}
                    markers={[ { val: 1, label: 'Low' }, { val: 2.5, label: 'Avg' }, { val: 4, label: 'High' } ]}
                    accentColor="accent-red-500"
                    labelColor="text-red-600"
                />

                <SliderWithMarkers 
                    label="Investments" 
                    subLabel="(Opp. Cost)"
                    name="stockReturn" 
                    value={inputs.stockReturn} 
                    min={0} max={15} step={0.1} 
                    onChange={handleInputChange}
                    markers={[ { val: 5, label: 'Safe' }, { val: 8.5, label: 'Avg' }, { val: 11, label: 'Risk' } ]}
                    accentColor="accent-yellow-500"
                    labelColor="text-yellow-600"
                />
            </div>
            
            {/* Down Payment */}
            <div className="pt-2">
              <label className="flex justify-between text-[10px] font-bold text-slate-500 uppercase tracking-wide mb-1">
                  <span>Down Payment ({inputs.downPaymentPercent}%)</span>
                  <span className="text-blue-600 font-mono normal-case text-xs">{formatMoney(inputs.homeValue * inputs.downPaymentPercent / 100)}</span>
              </label>
              <input type="range" min="0" max="100" step="1" name="downPaymentPercent" value={inputs.downPaymentPercent} onChange={handleInputChange} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"/>
            </div>
          </div>
        </div>

        {/* RIGHT PANEL: SEESAW CANVAS */}
        <div className="flex-grow bg-white rounded-xl shadow-lg border border-slate-200 relative overflow-hidden order-1 lg:order-2 min-h-[400px] flex flex-col">
          
          {/* Verdict Banner */}
          <div className={`absolute top-4 left-0 right-0 mx-auto w-fit px-4 py-1.5 rounded-full font-bold text-xs md:text-sm shadow-sm z-10 transition-colors duration-500 border
            ${tiltAngle > 0 ? 'bg-blue-600 text-white border-blue-700' : 'bg-slate-700 text-white border-slate-800'}`}>
            {tiltAngle > 0 ? "HEAVY RENT → SWITCH TO MORTGAGE" : "HEAVY MORTGAGE → KEEP RENTING"}
          </div>

          <svg viewBox="0 0 800 600" className="w-full h-full flex-grow touch-none select-none">
            
            {/* Static Ground */}
            <line x1="100" y1="550" x2="700" y2="550" stroke="#e2e8f0" strokeWidth="4" strokeLinecap="round" />
            
            {/* Fulcrum */}
            <path d={`M${pivotX} ${pivotY} L${pivotX - 30} ${pivotY + 60} L${pivotX + 30} ${pivotY + 60} Z`} fill="#64748b" />
            <circle cx={pivotX} cy={pivotY} r="6" fill="#475569" />

            {/* --- ROTATING GROUP --- */}
            <g transform={`rotate(${tiltAngle}, ${pivotX}, ${pivotY})`} className="transition-transform duration-700 ease-out">
              
              {/* Beam */}
              <rect x={pivotX - beamLength/2} y={pivotY - 10} width={beamLength} height={20} rx="10" fill="#334155" />
              
              {/* --- LEFT SIDE (BUY) --- */}
              <g transform={`translate(${pivotX - beamLength/2 + 40}, ${pivotY - 10})`}>
                {(() => {
                  let currentHeight = 0;
                  return breakdown.buyCosts.map((item) => {
                    const h = item.value * dynamicScale;
                    const y = -currentHeight - h;
                    currentHeight += h;
                    return (
                      <g key={item.id}>
                        <rect x="0" y={y} width="80" height={h} fill={item.color} stroke="white" strokeWidth="1" />
                        {h > 20 && (
                          <text x="40" y={y + h/2 + 4} textAnchor="middle" fill="white" fontSize="11" fontWeight="bold" style={{textShadow: '0px 1px 2px rgba(0,0,0,0.3)'}}>
                            {item.label}
                          </text>
                        )}
                      </g>
                    );
                  });
                })()}
                
                {/* GREEN BALLOONS (Appreciation) */}
                {(() => {
                    const stackHeight = totals.grossBuyCost * dynamicScale;
                    // Knot is anchored just above the stack
                    const knotY = -stackHeight - 60; 
                    const balloonCenterY = knotY - greenRadius;
                    
                    return (
                        <>
                        <line x1="40" y1={-stackHeight} x2="40" y2={knotY} stroke="#cbd5e1" strokeWidth="2" />
                        <g transform={`translate(0, 0)`}> {/* Using absolute coords calculated above */}
                            <circle cx="40" cy={balloonCenterY} r={greenRadius} fill="#10b981" opacity="0.95" className="transition-all duration-500" />
                            {/* Knot */}
                            <path d={`M 40 ${balloonCenterY + greenRadius + 4} L 34 ${balloonCenterY + greenRadius - 6} L 46 ${balloonCenterY + greenRadius - 6} Z`} fill="#10b981" />
                            
                            <text x="40" y={balloonCenterY - 6} textAnchor="middle" fill="white" fontSize={greenRadius > 40 ? 12 : 10} fontWeight="bold">APPR.</text>
                            <text x="40" y={balloonCenterY + 8} textAnchor="middle" fill="white" fontSize={greenRadius > 40 ? 11 : 9}>{formatMoney(totals.totalAppreciation)}</text>
                        </g>
                        </>
                    )
                })()}

                {/* Net Cost Label */}
                <g transform="translate(40, 35)">
                    <text y="0" textAnchor="middle" fill="#475569" fontSize="10" fontWeight="bold" letterSpacing="0.5">BUY NET COST</text>
                    <text y="16" textAnchor="middle" fill="#0f172a" fontSize="14" fontWeight="bold">{formatMoney(totals.netBuyCost)}</text>
                </g>
              </g>

              {/* --- RIGHT SIDE (RENT) --- */}
              <g transform={`translate(${pivotX + beamLength/2 - 120}, ${pivotY - 10})`}>
                {/* Rent Block */}
                <rect 
                  x="0" 
                  y={-totals.annualRent * dynamicScale} 
                  width="80" 
                  height={totals.annualRent * dynamicScale} 
                  fill="#64748b" 
                  stroke="white" 
                  strokeWidth="1" 
                />
                <text x="40" y={(-totals.annualRent * dynamicScale)/2 + 4} textAnchor="middle" fill="white" fontSize="12" fontWeight="bold" style={{textShadow: '0px 1px 2px rgba(0,0,0,0.3)'}}>RENT</text>
                
                {/* YELLOW BALLOONS (Investments) */}
                {(() => {
                    const stackHeight = totals.annualRent * dynamicScale;
                    const knotY = -stackHeight - 50;
                    const balloonCenterY = knotY - yellowRadius;

                    return (
                        <>
                        <line x1="40" y1={-stackHeight} x2="40" y2={knotY} stroke="#cbd5e1" strokeWidth="2" />
                        <g transform={`translate(0, 0)`}>
                            {/* Main Balloon */}
                            <circle cx="40" cy={balloonCenterY} r={yellowRadius} fill="#eab308" opacity="0.95" className="transition-all duration-500" />
                            <path d={`M 40 ${balloonCenterY + yellowRadius + 4} L 35 ${balloonCenterY + yellowRadius - 6} L 45 ${balloonCenterY + yellowRadius - 6} Z`} fill="#eab308" />
                            
                            <text x="40" y={balloonCenterY - 6} textAnchor="middle" fill="white" fontSize={yellowRadius > 40 ? 11 : 10} fontWeight="bold">INVEST.</text>
                            <text x="40" y={balloonCenterY + 8} textAnchor="middle" fill="white" fontSize={yellowRadius > 40 ? 10 : 9}>{formatMoney(totals.investmentReturn)}</text>
                        </g>
                        </>
                    )
                })()}

                {/* Rent Label */}
                <g transform="translate(40, 35)">
                    <text y="0" textAnchor="middle" fill="#475569" fontSize="10" fontWeight="bold" letterSpacing="0.5">RENT NET COST</text>
                    <text y="16" textAnchor="middle" fill="#0f172a" fontSize="14" fontWeight="bold">{formatMoney(totals.netRentCost)}</text>
                </g>
              </g>

            </g>

             {/* Tipping Markers */}
             <text x={pivotX - 200} y="580" textAnchor="middle" fill={tiltAngle < 0 ? "#334155" : "#cbd5e1"} fontSize="12" fontWeight="bold">KEEP RENTING</text>
             <text x={pivotX + 200} y="580" textAnchor="middle" fill={tiltAngle > 0 ? "#2563eb" : "#cbd5e1"} fontSize="12" fontWeight="bold">BUY (MORTGAGE)</text>

          </svg>

        </div>
      </div>
    </div>
  );
};

// Render the application
const rootElement = document.getElementById('root');
const root = ReactDOM.createRoot(rootElement);
root.render(<RentVsBuySeesaw />);
</script>

</body>
</html>
